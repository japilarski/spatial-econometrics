---
title: "Ekonometria Przestrzenna Projekt"
author: "Barbara Michalska, Julia Sulka, Julia Urban, Jakub Pilarski"
output:
  bookdown::html_document2:
    toc: true
    toc_depth: 2
    number_sections: true
    highlight: tango
    theme: paper
    css: style.css
    number_depth: 3
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.align='center'
)
```

```{r include=FALSE}
library(spdep)
library(sf)
library(tmap)
library(rnaturalearth)
library(dplyr)
library(psych)
library(knitr)
library(kableExtra)

dane <- read.csv("growthley.csv", sep = ",")  # lub sep = "," zależnie od formatu
dane$gdp_growth_1960_1980 <- dane$gdp_growth_1960_1980 / 100
dane$GDPsh560 <- dane$GDPsh560
dane$NEquip_Inv <- dane$NEquip_Inv * 100

coords <- cbind(dane$longitude, dane$latitude)
neighbors <- dnearneigh(coords, 0, 20)
weights <- nb2listw(neighbors, style = "W", zero.policy = TRUE)
```


# Wstęp
Współczesna analiza zjawisk ekonomicznych coraz częściej wymaga uwzględnienia aspektu przestrzennego. Tradycyjne modele ekonometryczne, zakładające niezależność obserwacji, mogą prowadzić do błędnych wniosków, gdy dane wykazują autokorelację przestrzenną — sytuację, w której obserwacje geograficznie bliskie są do siebie bardziej podobne niż te oddalone. Ekonometria przestrzenna, jako rozwijająca się dziedzina, dostarcza narzędzi umożliwiających uchwycenie tych zależności i dokładniejsze modelowanie rzeczywistości.

Celem niniejszego projektu jest zbadanie uwarunkowań wzrostu gospodarczego w krajach świata w latach 1960–1980 z wykorzystaniem metod ekonometrii przestrzennej. Zmienną zależną w analizie jest średnioroczny wzrost PKB per capita, natomiast zmiennymi objaśniającymi są m.in. przeciętna długość życia czy poziom inwestycji w kapitał nieprodukcyjny. Uwzględniono również aspekt regionalny w postaci binarnej zmiennej informującej o przynależności do regionu Afryki Subsaharyjskiej.

W analizie wykorzystano zarówno klasyczne podejście modelowania (regresję OLS), jak i modele uwzględniające efekty przestrzenne (SAR, SEM). Przeprowadzono eksploracyjną analizę danych przestrzennych (ESDA), oceniono istnienie autokorelacji przestrzennej oraz porównano jakość dopasowania modeli. Szczególną uwagę poświęcono interpretacji wyników pod kątem ich znaczenia ekonomicznego i potencjalnych implikacji dla polityki publicznej.


# Problem badawczy

Celem niniejszej pracy jest empiryczna weryfikacja hipotezy, że tempo wzrostu gospodarczego krajów w latach 1960–1980 nie było przestrzennie losowe, lecz wykazywało istotne zróżnicowanie geograficzne wynikające zarówno z lokalnych uwarunkowań instytucjonalno-ekonomicznych, jak i efektów przestrzennych. Głównym problemem badawczym jest określenie, w jakim stopniu zmienne takie jak jakość instytucji prawnych, struktura inwestycji, poziom dochodu początkowego oraz przynależność regionalna wpływają na dynamikę wzrostu PKB, a także czy uwzględnienie zależności przestrzennych za pomocą modeli SAR i SEM istotnie poprawia wyjaśnianie zmienności tej dynamiki względem klasycznego modelu OLS. Kluczowym aspektem analizy jest identyfikacja obecności autokorelacji przestrzennej oraz ocena siły i zasięgu jej oddziaływania.

# Przegląd literatury

Coraz większego znaczenia nabiera ekonometria przestrzenna, która pozwala uwzględniać geograficzne sąsiedztwo i przestrzenne zależności pomiędzy obserwacjami. Przełomową rolę odegrała tu książka Anselina (1988), w której autor przedstawił podstawowe modele przestrzenne, takie jak SAR (Spatial Autoregressive), SEM (Spatial Error Model) i SDM (Spatial Durbin Model). Modele te umożliwiają uchwycenie wpływu zjawisk zachodzących w sąsiednich regionach – przykładowo tempa wzrostu PKB. SAR zakłada, że wartość zmiennej zależnej zależy od jej wartości w regionach sąsiadujących; SEM koncentruje się na przestrzennej korelacji w składniku losowym; natomiast SDM uwzględnia zarówno zależności przestrzenne zmiennej objaśnianej, jak i zmiennych niezależnych.

Do rozwoju metodologii przyczynili się także Elhorst (2010) oraz LeSage i Pace (2009), proponując bardziej zaawansowane techniki estymacji i interpretacji wyników. Szczególną uwagę zwracają na analizę efektów bezpośrednich i pośrednich, a także właściwy dobór modelu do struktury danych. Model SDM, dzięki swojej elastyczności, uznawany jest za jeden z najbardziej uniwersalnych – obejmuje on zarówno SAR, jak i SLX jako przypadki szczególne.

W literaturze szeroko udokumentowano istnienie regionalnej konwergencji i przestrzennego rozlewania się wzrostu. Przykładowo, Rey i Montouri (1999) zastosowali modele SAR i SEM do badania konwergencji dochodów w USA, dowodząc, że nieuwzględnienie zależności przestrzennych może prowadzić do przeszacowania tego efektu. Podobnie Fingleton (2001) podkreśla, że wzrost gospodarczy regionu zależy zarówno od czynników wewnętrznych, takich jak inwestycje czy kapitał ludzki, jak i impulsów płynących z otoczenia.

Na poziomie globalnym przestrzenna analiza wzrostu pozwala lepiej zrozumieć, czy rozwój poszczególnych gospodarek ma charakter wzajemnie powiązany systemowo, czy wynika głównie z uwarunkowań krajowych. Z danych OECD (2020) wynika, że nowoczesne polityki rozwoju regionalnego i lokalnego powinny uwzględniać zarówno zasoby endogeniczne, jak i szersze konteksty międzynarodowe.


# Opis danych

Analiza ekonometryczna opiera się na zestawie danych przekrojowych obejmujących wybrane kraje świata, dla których dostępne były informacje dotyczące zarówno wskaźników społeczno-ekonomicznych, jak i zmiennych przestrzennych. Dane dotyczą okresu od 1960 do 1980 roku i umożliwiają zbadanie uwarunkowań wzrostu gospodarczego w perspektywie długookresowej, z uwzględnieniem aspektów instytucjonalnych, inwestycyjnych oraz regionalnych.

Zmienna zależna reprezentuje średnioroczny wzrost PKB per capita w latach 1960–1980. Wśród zmiennych objaśniających uwzględniono zarówno zmienne ilościowe, jak długość życia, udział inwestycji w kapitał nieprodukcyjny czy poziom zamożności początkowej, jak i zmienną jakościową informującą o przynależności danego kraju do regionu Afryki Subsaharyjskiej. Dane zostały uzupełnione o komponent przestrzenny w postaci informacji o sąsiedztwie geograficznym między państwami, co umożliwia estymację modeli uwzględniających zależności przestrzenne.

W dalszej części rozdziału przedstawiono szczegółowy opis poszczególnych zmiennych, ich podstawowe statystyki opisowe oraz omówiono kwestie związane z brakami danych i potencjalnymi obserwacjami odstającymi

## Zmienna zależna

Zmienną objaśnianą w niniejszej analizie jest średnioroczna stopa wzrostu produktu krajowego brutto (PKB) per capita w latach 1960–1980 (*gdp_growth_1960_1980*). Wybór tej zmiennej wynika z chęci zbadania długookresowych determinant wzrostu gospodarczego oraz ich potencjalnych zależności przestrzennych. Wskaźnik ten pozwala ocenić tempo rozwoju ekonomicznego poszczególnych krajów w badanym okresie oraz stanowi podstawę do identyfikacji wzorców przestrzennych i regionalnych różnic.

``` {r fig.cap="Zmienna zależna"}
world <- ne_countries(scale = "medium", returnclass = "sf")
world_merged <- world %>%
  left_join(dane, by = c("name" = "country_name"))

tmap_mode("plot")
tm_shape(world_merged) +
  tm_polygons("gdp_growth_1960_1980", 
              palette = "RdBu", 
              title = "Średnioroczny wzrost PKB w latach 1960-1980") +
  tm_layout(legend.outside = TRUE)

```


## Zmienne objaśniające

Zmiennymi objaśniającymi w modelu są wyselekcjonowane wskaźniki ekonomiczne, demograficzne i instytucjonalne, które zgodnie z literaturą przedmiotu mogą mieć istotny wpływ na tempo wzrostu gospodarczego. Uwzględniono zarówno zmienne ilościowe, takie jak przeciętna długość życia, poziom inwestycji nieinfrastrukturalnych, jakość instytucji prawnych oraz logarytm PKB per capita w roku 1960, jak i zmienną jakościową wskazującą na przynależność do regionu Afryki Subsaharyjskiej. Celem uwzględnienia tych zmiennych jest zbadanie ich siły oddziaływania oraz ewentualnej interakcji z efektami przestrzennymi.

### Zmienne ilościowe
- Średnia długość życia (*Life_Exp*) — przeciętna liczba lat, jaką statystycznie oczekuje się, że przeżyje osoba urodzona w danym kraju. Wysoka wartość zwykle wskazuje na lepszy poziom zdrowia i warunki życia.
- Procent wydatków nieprodukcyjnych (*NEquip_Inv*) - rozumiany jako wydatki inne niż w środki trwałe, np. kapitał ludzki, infrastruktura społeczna.
- Indeks praworządności (*Rule_of_Law*) — mierzy stopień przestrzegania prawa, stabilność systemu prawnego oraz skuteczność wymiaru sprawiedliwości w danym kraju. Wyższe wartości oznaczają lepszą jakość instytucji i często korelują z wyższym rozwojem gospodarczym.
- Logarytm naturalny PKB per capita w roku 1960 (*GDPsh560*) - wartości tej zmiennej odzwierciedlają poziom zamożności krajów w początkowym roku analizy. Dzięki logarytmicznej transformacji możliwe jest zmniejszenie wpływu wartości odstających oraz uzyskanie bardziej symetrycznego rozkładu, co sprzyja modelowaniu. Wysokie wartości GDPsh560 oznaczają wyższy poziom dochodu per capita w 1960 r., co może mieć wpływ na tempo późniejszego rozwoju gospodarczego.

### Zmienna jakościowa
Zmienna binarna oznaczająca, czy kraj znajduje się w regionie Afryki Subsaharyjskiej (*SubSahara*). Wpływa na analizę regionalną i często wiąże się z charakterystycznymi wyzwaniami gospodarczymi i społecznymi.


### Wybrane kartogramy

W celu wizualnego zidentyfikowania przestrzennych wzorców badanych zjawisk, wykorzystano kartogramy ilustrujące rozmieszczenie zmiennych objaśniających. Graficzna reprezentacja danych w układzie geograficznym pozwala na wstępną ocenę potencjalnej autokorelacji przestrzennej oraz wskazuje na istnienie regionalnych skupisk o podobnych wartościach. Kartogramy stanowią istotny element eksploracyjnej analizy danych przestrzennych (ESDA), wspomagając interpretację wyników statystycznych i modelowych.

``` {r fig.cap="Średnia przewidywana długość życia"}
tm_shape(world_merged) +
  tm_polygons("Life_Exp", 
              palette = "Blues", 
              title = "Średnia przewidywana długość życia") +
  tm_layout(legend.outside = TRUE)
```

``` {r fig.cap="Wskaźnik jakości rządów prawa"}

tm_shape(world_merged) +
  tm_polygons("Rule_of_Law", 
              palette = "Blues", 
              title = "Wskaźnik jakości rządów prawa") +
  tm_layout(legend.outside = TRUE)
```

``` {r fig.cap="Wydatki inne niż w środki trwałe"}

tm_shape(world_merged) +
  tm_polygons("NEquip_Inv", 
              palette = "Blues", 
              title = "Wydatki inne niż w środki trwałe") +
  tm_layout(legend.outside = TRUE)
```

``` {r fig.cap="Logarytm naturalny PKB per capita w roku 1960"}

tm_shape(world_merged) +
  tm_polygons("GDPsh560", 
              palette = "Blues", 
              title = "Logarytm naturalny PKB per capita w roku 1960") +
  tm_layout(legend.outside = TRUE)

```

## Macierz wag przestrzennych

W niniejszym rozdziale przedstawiono sposób konstrukcji macierzy wag przestrzennych, która odgrywa kluczową rolę w analizach przestrzennych. Została ona oparta na relacjach sąsiedztwa pomiędzy krajami uwzględnionymi w zbiorze danych. W pierwszej kolejności utworzono reprezentację przestrzenną krajów w postaci punktów z przypisanymi współrzędnymi geograficznymi. Następnie określono, które kraje są sobie geograficznie bliskie i mogą być traktowane jako sąsiedzi — na tej podstawie zbudowano graf sąsiedztwa. Dla zwiększenia czytelności, na poniższym kartogramie pokazano tylko najsilniejsze relacje. 

``` {r fig.cap="Kartogram z grafem sąsiedztwa"}
library(sf)
library(sp)
library(spdep)
library(tmap)
library(tmaptools)
library(rnaturalearth)
library(rnaturalearthdata)

world <- ne_countries(scale = "medium", returnclass = "sf")
coords_sf <- st_as_sf(dane, coords = c("longitude", "latitude"), crs = 4326)
lines_list <- nb2lines(neighbors, coords = sp::coordinates(as_Spatial(coords_sf)), 
                       proj4string = CRS("+proj=longlat +datum=WGS84"))
lines_sf <- st_as_sf(lines_list)
tmap_mode("plot")
tm_shape(world) +
  tm_borders() +
  tm_shape(lines_sf) +
  tm_lines(col = "red", lwd = 1) +
  tm_shape(coords_sf) +
  tm_dots(col = "blue", size = 0.1) +
  tm_layout(legend.show = FALSE)

```

Wizualizacja mapy z naniesionym grafem umożliwia szybkie zrozumienie układu przestrzennego i potencjalnych zależności między obserwacjami. Na mapie przedstawiono zarówno lokalizacje krajów, jak i połączenia między nimi oznaczające relacje sąsiedztwa.

``` {r}
W_matrix <- as.matrix(listw2mat(weights))

rownames(W_matrix) <- dane$country_name
colnames(W_matrix) <- dane$country_name

W_matrix_subset <- W_matrix[14:19, 14:19]

kable(W_matrix_subset, caption = "Fragment macierzy wag przestrzennych", digits = 2)
```

Na podstawie tak zdefiniowanych relacji przestrzennych skonstruowano macierz wag przestrzennych, która informuje, które kraje wpływają na siebie nawzajem w analizie. Dla czytelności przedstawiono jej fragment w formie tabelarycznej. Dodatkowo zaprezentowano tabelę z przypisanymi sąsiadami dla wybranych krajów, co ułatwia interpretację powiązań przestrzennych.

``` {r}
library(tibble)
library(tidyr)

neighbors_df <- tibble(
  country = dane$country_name,
  neighbors = sapply(neighbors, function(n) paste(dane$country_name[n], collapse = ", "))
)

# Piękna tabela
library(knitr)
library(kableExtra)

kable(head(neighbors_df, 10), caption = "Lista sąsiadów wybranych państw")
```

# Analiza opisowa

Rozdział ten ma na celu wstępne zapoznanie się ze strukturą danych oraz identyfikację podstawowych charakterystyk statystycznych badanych zmiennych. Analiza opisowa obejmuje zarówno ocenę rozkładów zmiennych ilościowych, jak i obserwacji odstających, które mogą wpływać na wyniki dalszego modelowania. Obliczone zostaną klasyczne statystyki opisowe, takie jak średnia, mediana, wartości skrajne, odchylenie standardowe oraz współczynniki asymetrii. Uzupełnieniem analizy będą wykresy rozrzutu, histogramy i wykresy gęstości, które umożliwią lepsze zrozumienie rozkładu danych oraz potencjalnych zależności pomiędzy zmiennymi. Tak przeprowadzona analiza stanowi niezbędny etap przygotowawczy przed estymacją modeli ekonometrycznych.

## Zmienne ilościowe
``` {r}
stats <- describe(dane[, c(
  "Life_Exp",
  "GDPsh560",
  "NEquip_Inv",
  "Rule_of_Law"
)])
stats_selected <- stats[, c("mean", "sd", "min", "median", "max")]
opisy <- c(
  Life_Exp = "Oczekiwana długość życia",
  GDPsh560 = "Logarytm naturalny PKB per capita w roku 1960",
  NEquip_Inv = "Procent wydatków innych niż w środki trwałe",
  Rule_of_Law = "Jakość rządów prawa"
)

stats_selected$Zmienna <- opisy[rownames(stats_selected)]
stats_selected <- stats_selected[, c("Zmienna", setdiff(names(stats_selected), "Zmienna"))]
kable(stats_selected,
      caption = "Podstawowe statystyki opisowe wybranych zmiennych",
      digits = 1,
      col.names = c("Zmienna", "Średnia", "Odchylenie standardowe", "Minimum", "Mediana", "Maksimum"),
      row.names = FALSE)
```
Analiza opisowa wybranych zmiennych ilościowych przedstawia ogólny obraz różnic społeczno - gospodarczych w badanych krajach.

Oczekiwana długość życia wynosi średnio prawie 57 lat, przy odchyleniu standardowym równym 11,39. Wartości wahają się od 37,90 do 73,40 lat, co wskazuje na znaczne zróżnicowanie w poziomie zdrowia publicznego i warunkach życia w analizowanych państwach.

Średni udział inwestycji innych niż w środki trwałe wynosi 14,94%, z zakresem od 3,71% do 28,03% i umiarkowanym odchyleniem standardowym na poziomie 5,48. Mediana równa 14,75% sugeruje względnie symetryczny rozkład tej zmiennej.


Ostatnia zmienna – jakość rządów prawa – mierzona w skali od 0 do 1, ma średnią wartość 0,54 i medianę 0,50. To świadczy o umiarkowanym, lecz wyraźnym zróżnicowaniu w zakresie instytucjonalnym pomiędzy badanymi krajami.

### Histogramy

Histogramy czterech zmiennych ilościowych zawartych w zbiorze danych ujawniają istotne cechy rozkładu danych i pozwalają lepiej zrozumieć ich strukturę.

``` {r fig.cap="Histogramy zmiennych ilościowych"}
library(ggplot2)
library(gridExtra)

vars <- c("Life_Exp", "GDPsh560", "NEquip_Inv", "Rule_of_Law")
histograms <- lapply(vars, function(var) {
  ggplot(dane, aes_string(x = var)) +
    geom_histogram(bins = 20, fill = "#69b3a2", color = "white", alpha = 0.8) +
    theme_minimal() +
    labs(x = var, y = "Liczba obserwacji")
})

do.call(grid.arrange, c(histograms, ncol = 2))
```

Zmienna *Life_Exp* wykazuje rozkład wielomodalny — widać wyraźne skupiska obserwacji w okolicach 45–50 oraz 65–70 lat. Sugeruje to, że dane mogą pochodzić z krajów o bardzo zróżnicowanym poziomie rozwoju, przy czym kraje rozwinięte i rozwijające się tworzą odrębne grupy pod względem długości życia.

Zmienna *GDPsh560*, czyli logarytm PKB per capita z 1960 roku, ma rozkład zbliżony do normalnego, chociaż z lekką lewostronną skośnością. Większość obserwacji skupia się w przedziale 7–8, co może oznaczać, że znaczna liczba krajów miała umiarkowany poziom dochodu, a jedynie niewielka liczba krajów cechowała się bardzo niskim PKB.

W przypadku zmiennej *NEquip_Inv* rozkład jest rozproszony, z wyraźnym skupiskiem między 10 a 20 procentami. Występuje delikatna prawostronna skośność, co może mieć znaczenie przy dalszym modelowaniu — w razie potrzeby warto rozważyć transformację tej zmiennej.

Ostatnia zmienna, *Rule_of_Law* , ma wyraźnie skośny rozkład, z dużą liczbą obserwacji skupionych na wartościach 0 i 1. Może to sugerować, że wskaźnik ten przyjmuje w praktyce charakter quasi-dyskretny, co odzwierciedla skrajne różnice w poziomie jakości instytucji między krajami.

Na podstawie tej analizy można stwierdzić, że zmienne reprezentują różnorodne rozkłady, co może mieć wpływ na dalsze analizy statystyczne i modelowanie ekonometryczne. 

### Wykresy gęstości

``` {r fig.cap="Wykresy gęstości dla zmiennych ilościowych"}
library(ggplot2)
library(tidyr)
library(dplyr)

dane_long <- dane %>%
  select(Life_Exp, GDPsh560, NEquip_Inv, Rule_of_Law) %>%
  pivot_longer(cols = everything(), names_to = "Zmienna", values_to = "Wartość")

ggplot(dane_long, aes(x = Wartość, fill = Zmienna)) +
  geom_density(alpha = 0.6) +
  facet_wrap(~Zmienna, scales = "free") +
  labs(x = "Wartość", y = "Gęstość") +
  theme_minimal() +
  theme(legend.position = "none")
```

Wykresy gęstości przedstawiają rozkład czterech zmiennych ilościowych w zbiorze danych.
Zmienna *Life_Exp* prezentuje rozkład dwumodalny, w próbie występują dwie grupy krajów o wyraźnie różnych długościach życia.
Dla *GDPsh560* widzimy rozkład lekko asymetryczny z przewagą krajów o średnich wartościach logarytmu PKB. Wskazuje na nierównomierny poziom rozwoju gospodarczego.
Z kolei rozkład *NEquip_Inv* jest zbliżony do normalnego, wskazujący na względnie równomierne rozłożenie wartości w próbie.
Zmienna *Rule_of_Law* prezentuje rozkład zbliżony do dwumodalnego, sugeruje pewne zróżnicowanie między krajami pod względem siły rządów prawa, z koncentracją przy niskich i wysokich wartościach.

### Korelacja zmiennych ilościowych 

``` {r}
library(knitr)
library(kableExtra)

vars <- c("Life_Exp", "GDPsh560", "NEquip_Inv", "Rule_of_Law")
dane_sub <- dane[, vars]

cor_matrix <- cor(dane_sub, method = "pearson", use = "complete.obs")

kable(cor_matrix, digits = 3, caption = "Macierz korelacji")
```

Analiza macierzy korelacji wykazała istotne powiązania między badanymi zmiennymi ilościowymi. Oczekiwana długość życia (*Life_Exp*) jest silnie skorelowana dodatnio z PKB per capita (*GDPsh560*) oraz wskaźnikiem praworządności (*Rule_of_Law*), odpowiednio na poziomie 0,859 oraz 0,711. Oznacza to, że wyższy poziom dochodu na mieszkańca oraz lepsza jakość instytucji i rządów są związane z dłuższą średnią długością życia ludności.
Udział wydatków innych niż na środki trwałe, takich jak inwestycje w kapitał ludzki czy infrastrukturę społeczną (*NEquip_Inv*), wykazuje umiarkowaną dodatnią korelację z oczekiwaną długością życia (*0,456*) oraz umiarkowane powiązania z pozostałymi zmiennymi. Sugeruje to, że tego typu nakłady również mają pozytywny wpływ na warunki życia, choć związek ten jest słabszy niż w przypadku PKB czy praworządności.
Podsumowując, wyniki potwierdzają, że poziom dochodu oraz stan instytucji są silnie powiązane a jakością życia, a inwestycje w kapitał ludzki i infrastrukturę społeczną również mogą wspierać poprawę warunków życia, choć w mniejszym stopniu.

## Zmienna jakościowa

``` {r }
dane %>%
  count(SubSahara) %>%
  mutate(
    Kategoria = ifelse(SubSahara == 1, "Tak (Afryka Subsaharyjska)", "Nie"),
    Procent = round(n / sum(n) * 100, 2)
  ) %>%
  select(Kategoria, Liczba = n, Procent) %>%
  kable(
    caption = "Rozkład zmiennej SubSahara",
    col.names = c("Kategoria", "Liczba obserwacji", "Procent"),
    align = "lrr"
  )
```
Zmienna *SubSahara* dzieli analizowane państwa na dwie grupy: należące do regionu Afryki Subsaharyjskiej (1) oraz pozostałe (0). W zestawieniu danych:
80,6% państw (54 obserwacje) nie należy do Afryki Subsaharyjskiej, natomiast 19,4% państw (13 obserwacji) pochodzi z tego regionu.
Taki rozkład wskazuje na znaczną przewagę państw spoza Afryki Subsaharyjskiej w analizowanej próbie, co warto uwzględnić przy interpretacji wyników modeli przestrzennych czy statystyk opisowych. 


# Eksploracyjna analiza danych przestrzennych 

Celem niniejszego rozdziału jest identyfikacja oraz wstępne zrozumienie przestrzennych zależności i wzorców występujących w badanym zbiorze danych. Eksploracyjna analiza danych przestrzennych (ESDA) stanowi kluczowy etap w analizie ekonomicznej zjawisk geograficznych, umożliwiając ocenę siły i charakteru przestrzennej autokorelacji przed przystąpieniem do estymacji modeli przestrzennych.
W pierwszej kolejności obliczony zostanie globalny wskaźnik autokorelacji przestrzennej Morana (Moran’s I) dla zmiennej zależnej, co pozwoli ocenić, czy wartości wzrostu PKB per capita wykazują tendencję do grupowania się przestrzennego. Następnie oszacowany zostanie klasyczny model liniowy (OLS), a jego reszty poddane zostaną analizie pod kątem przestrzennej autokorelacji — ponownie z wykorzystaniem testu Morana. W dalszej części przeprowadzone zostaną testy Lagrange’a (LM i LM-robust), które wskazują na adekwatność zastosowania modeli przestrzennych (SAR lub SEM). Rozdział zamyka analiza lokalnych wskaźników autokorelacji przestrzennej (LISA), których wyniki zostaną również zaprezentowane w formie graficznej. Umożliwia to identyfikację lokalnych skupisk (hot spots i cold spots) oraz obserwacji odstających pod względem przestrzennym.

## Test Moran I

W celu sprawdzenia istnienia przestrzennej autokorelacji tempa wzrostu PKB per capita w latach 1960–1980 przeprowadzono test Morana. Test ten pozwala ocenić, czy wartości analizowanej zmiennej wykazują tendencję do grupowania się przestrzennie — czyli czy kraje o podobnych wartościach wzrostu PKB sąsiadują ze sobą częściej, niż wynikałoby to z przypadku.

``` {r moran_I_test}
moran_result <- moran.test(dane$gdp_growth_1960_1980, weights, zero.policy = TRUE)
```

Wynik testu Morana dla zmiennej gdp_growth_1960_1980 wyniósł I = 0.664, przy oczekiwanej wartości statystyki pod hipotezą braku autokorelacji równej –0.016 oraz bardzo niskim poziomie wartości p (< 2.2e-16). Tak wysoka wartość statystyki Morana oraz istotność testu wskazują jednoznacznie na silnie dodatnią przestrzenną autokorelację wzrostu PKB – kraje o podobnych wynikach wzrostu gospodarczego były skupione geograficznie.

Taki wynik potwierdza, że przestrzenne rozmieszczenie danych ma znaczenie analityczne i należy je uwzględniać w dalszych modelach statystycznych.

## Model linowy

W celu zbadania czynników wpływających na wzrost PKB per capita w latach 1960–1980 skonstruowano model regresji liniowej. Zmienną objaśnianą jest gdp_growth_1960_1980, natomiast zmiennymi objaśniającymi są:
Model tłumaczy około 70% zmienności wzrostu PKB per capita (R² = 0.7005), co wskazuje na dobr3 dopasowanie. Wszystkie zmienne są statystycznie istotne na poziomie istotności większym niż 0.01.

``` {r}
model_reduced <- lm(
  gdp_growth_1960_1980 ~
    Life_Exp + 
    GDPsh560 + 
    NEquip_Inv +
    Rule_of_Law +
    SubSahara,
  data = dane
)
coef_table <- data.frame(
  Zmienna = c("Intercept", "Life_Exp", "GDPsh560", "NEquip_Inv", "Rule_of_Law", "SubSahara"),
  Współczynnik = c(10.69607, 0.10593, -2.23097, 0.07501, 2.65482, -2.25614),
  Interpretacja = c(
    "Wartość średniorocznego wzrostu PKB przy zerowych wartościach zmiennych objaśniających",
    "Każdy dodatkowy rok życia zwiększa wzrost PKB o ok. 0.11 punktu procentowego",
    "Wyższy poziom PKB per capita w 1960 r. koreluje z niższym tempem wzrostu (efekt doganiania)",
    "Większy udział wydatków innych niż środki trwałe wiąże się z nieznacznym wzrostem wzrostu PKB",
    "Lepszy indeks praworządności sprzyja wyższemu tempu wzrostu gospodarczego",
    "Kraje Afryki Subsaharyjskiej mają średnio niższe tempo wzrostu PKB o około 2.26 punktu procentowego"
  )
)

kable(coef_table, 
      col.names = c("Zmienna", "Współczynnik", "Interpretacja"), 
      caption = "Wyniki estymacji klasycznego modelu liniowego (OLS)")

```


Model wskazuje na istotną rolę kapitału ludzkiego, rządów prawa oraz poziomu wyjściowego rozwoju w kształtowaniu wzrostu gospodarczego w krajach świata w latach 1960–1980.

## Test Moran I dla reszt modelu liniowego
``` {r Moran_I_Test_of_residuals}
model_reduced_residuals <- residuals(model_reduced)

moran_residualds <- moran.test(model_reduced_residuals, weights)
```

W celu sprawdzenia, czy reszty modelu regresji liniowej wykazują przestrzenną autokorelację, przeprowadzono test Morana I dla reszt modelu.
Wynik testu: Moran I = 0.336, p-value = 9.34e-07, wariancja: 0.00546.

Wysoka dodatnia wartość statystyki Morana i bardzo niska p-wartość pozwalają odrzucić hipotezę zerową o braku autokorelacji przestrzennej. Oznacza to, że reszty modelu nie są niezależne przestrzennie — kraje geograficznie bliskie sobie mają podobne wartości reszt. Taki wynik sugeruje, że model może nie w pełni uwzględniać efektów przestrzennych i warto rozważyć zastosowanie modelu regresji przestrzennej (np. SAR lub SEM).

## Test Lagrange Multiplayer
``` {r lagrange_multiplier_test}
lm_test <- lm.LMtests(model_reduced, listw = weights, test = c("LMerr", "LMlag", "RLMerr", "RLMlag"))
```

W celu zidentyfikowania obecności zależności przestrzennej w danych, zastosowano cztery testy Lagrange Multiplayer (LM), znane również jako testy Rao's score:

1. LM-error (RSerr): wykazał istotność statystyczną (p < 0.00001), co sugeruje obecność przestrzennej autokorelacji w składniku losowym.
2. LM-lag (RSlag): również istotny (p < 0.00001), co wskazuje na możliwą zależność przestrzenną w zmiennej objaśnianej.
3. Skorygowany LM-error (adjRSerr): istotny (p = 0.0114), co potwierdza, że po uwzględnieniu wpływu efektu lag nadal występuje przestrzenna autokorelacja w resztach.
4. Skorygowany LM-lag (adjRSlag): istotny (p = 0.0158), co również wskazuje na istotną przestrzenną zależność typu lag.

Ponieważ obie skorygowane wersje testów (adjRSerr i adjRSlag) są istotne, można wnioskować, że zarówno model SAR (z efektem lag), jak i SEM (z efektem błędu) są potencjalnie adekwatne. W takiej sytuacji zaleca się porównać dopasowanie obu modeli przestrzennych i ocenić, który lepiej opisuje dane.

## Wskaźniki LISA i ich wizualizacja

Wskaźniki lokalne autokorelacji przestrzennej (LISA — Local Indicators of Spatial Association) służą do wykrywania przestrzennych wzorców korelacji lokalnych, czyli np. skupisk wartości wysokich lub niskich w danych geograficznych. (Poniższy kartogram jest interaktywny, można go zmieniać przybliżenie i przesuwać mapę.) 

``` {r fig.cap="Wskaźniki LISA"}
library(sf)
library(spdep)
library(tmap)

coords_m <- st_coordinates(coords_sf)

neighbors <- dnearneigh(coords, 0, 20000)

weights <- nb2listw(neighbors, style = "W", zero.policy = TRUE)

local_moran <- localmoran(dane$gdp_growth_1960_1980, weights, zero.policy = TRUE)

coords_sf$Ii <- local_moran[, "Ii"]
coords_sf$Z <- local_moran[, "Z.Ii"]
coords_sf$pvalue <- local_moran[, "Pr(z != E(Ii))"]

mean_value <- mean(dane$gdp_growth_1960_1980, na.rm = TRUE)
mean_Ii <- mean(coords_sf$Ii, na.rm = TRUE)

coords_sf$kwadranty <- with(coords_sf, 
  ifelse(gdp_growth_1960_1980 > mean_value & Ii > mean_Ii, "High-High",
  ifelse(gdp_growth_1960_1980 < mean_value & Ii < mean_Ii, "Low-Low",
  ifelse(gdp_growth_1960_1980 > mean_value & Ii < mean_Ii, "High-Low",
  ifelse(gdp_growth_1960_1980 < mean_value & Ii > mean_Ii, "Low-High", NA)))))

tmap_mode("view")  # interaktywna mapa

tm_shape(coords_sf) +
  tm_dots(col = "kwadranty", palette = c("red", "pink", "lightblue", "blue")) +
  tm_layout(legend.outside = TRUE)
```

W celu identyfikacji przestrzennych wzorców zmiennej badanej zastosowano lokalny wskaźnik Morana. Metoda ta pozwala wykryć obszary o statystycznie istotnym skupieniu podobnych wartości, co wskazuje na występowanie przestrzennych klastrów.
Na mapie przedstawiono podział obszarów na cztery typy przestrzennych zależności:

1. Klastry wysokich wartości (High-High): Regiony o wysokich wartościach zmiennej, otoczone przez inne obszary charakteryzujące się wysokimi wartościami. Są to tzw. „gorące punkty”, które wskazują na silne zjawiska koncentracji.
2. Klastry niskich wartości (Low-Low): Obszary o niskich wartościach zmiennej, które sąsiadują z regionami o niskich wartościach. Takie skupiska wskazują na regiony o niskim poziomie średniego wzrostu PKB.
3. Obszary o wysokich wartościach otoczone niskimi (High-Low): Lokalizacje, gdzie obserwuje się anomalie — wysoka wartość w otoczeniu niskich. Mogą to być potencjalne punkty zainteresowania do dalszej analizy, wskazujące np. na niejednorodność zjawiska.
4. Obszary o niskich wartościach otoczone wysokimi (Low-High): Przeciwny przypadek do poprzedniego, gdzie niska wartość występuje w regionie o wysokich wartościach.

Wyniki lokalnego wskaźnika Morana zostały poddane testowi istotności statystycznej (p < 0,05), co pozwoliło wyróżnić tylko te klastry, które charakteryzują się istotną przestrzenną autokorelacją. Wizualizacja na mapie umożliwia szybkie zlokalizowanie i interpretację obszarów o różnym charakterze przestrzennym, wspierając podejmowanie decyzji i dalsze analizy przestrzenne.

Na wykresie wyraźnie widać gorące skupisko w rejonie europy oraz zimne w Afryce. W rejonie azji wschodniej widoczna jest dominuja państwa o charakterze High-Low, wynika to z fakty bardzo słabego średniego wzrostu gospodarczego na Filipinach. W Ameryce południowej przeplatają się wszystkie typy obszarów.   

# Modelowanie ekonometryczne

Celem niniejszego rozdziału jest oszacowanie oraz porównanie dwóch podejść do modelowania zmiennej zależnej – klasycznego modelu regresji liniowej (OLS) oraz modelu przestrzennego SAR (Spatial Autoregressive Model). Wybór tych modeli umożliwia ocenę, na ile pominięcie zależności przestrzennych może prowadzić do błędnej specyfikacji modelu oraz zaniżenia precyzji estymacji parametrów.

Model OLS stanowi punkt wyjścia dla dalszych analiz i pozwala na identyfikację podstawowych zależności pomiędzy zmiennymi objaśniającymi a tempem wzrostu PKB per capita. W kolejnym kroku zastosowano model SAR, który uwzględnia efekt przestrzennie opóźnionej zmiennej objaśnianej, pozwalając na uchwycenie wpływu wartości zmiennej zależnej w sąsiednich jednostkach terytorialnych. Ujęcie to znajduje uzasadnienie w wynikach wcześniejszych testów autokorelacji przestrzennej (Moran’s I), które wskazują na istotne przestrzenne współzależności.

Porównanie obu modeli pozwala określić, w jakim stopniu uwzględnienie efektów przestrzennych wpływa na trafność i wiarygodność wniosków ekonomicznych.

## Model przestrzenny SAR

Model przestrzenny SAR (Spatial Autoregressive Model) służy do uwzględniania przestrzennej zależności między jednostkami obserwacyjnymi (np. krajami, regionami, województwami) w modelowaniu ekonometrycznym.
Używamy modelu kiedy chcemy złapać efekt "wpływu sąsiadów". Przez co pozwala na bardziej trafne wnioskowanie oraz unikanie błędów wynikających z pominięcia zależności przestrzennych.

``` {r model przestrzeny SAR}
library(sf)
library(spdep)
library(spatialreg)
library(dplyr)

data_sar <- world_merged %>%
  dplyr::select(gdp_growth_1960_1980, Life_Exp, NEquip_Inv, Rule_of_Law, GDPsh560, SubSahara, geometry) %>%
  na.omit()

nb <- poly2nb(data_sar)
lw <- nb2listw(nb, style = "W", zero.policy = TRUE) 
sar_model <- lagsarlm(
  formula = gdp_growth_1960_1980 ~ Life_Exp + NEquip_Inv + Rule_of_Law + GDPsh560 + SubSahara,
  data = data_sar,
  listw = lw,
  zero.policy = TRUE
)

summary(sar_model)
```

Istotność parametrów oceniono na podstawie wartości p (pochodzących z oszacowanego modelu) w porównaniu z poziomem istotności 0,05. Spośród zmiennych uwzględnionych w modelu istotne statystycznie okazały się

Life_Exp (średnia długość życia) – wzrost średniej długości życia o jedną jednostkę powoduje wzrost średniego wzrostu PKB w latach 1960-1980 o około 0,109, przy założeniu stałości pozostałych zmiennych; wyższy poziom zdrowia i warunków życia sprzyja rozwojowi gospodarczemu.

NEquip_Inv (wydatki inne niż na środki trwałe) – wzrost wydatków o jedną jednostkę zwiększa wzrost PKB o około 0,064, przy pozostałych czynnikach niezmienionych; inwestycje w kapitał ludzki i infrastrukturę społeczną pozytywnie wpływają na rozwój gospodarczy.

Rule_of_Law (praworządność) – wzrost wskaźnika praworządności o jedną jednostkę wiąże się ze wzrostem średniego wzrostu PKB o około 2,75, co wskazuje na silny pozytywny wpływ jakości instytucji i stabilności prawnej na rozwój gospodarczy.

GDPsh560 (logarytm PKB per capita w 1960) – wykazuje istotny ujemny wpływ, gdzie wzrost tej zmiennej o jedną jednostkę powoduje spadek wzrostu PKB o około 2,36, co można interpretować jako efekt doganiania – kraje biedniejsze w 1960 rozwijały się szybciej.

SubSahara (lokalizacja w Afryce Subsaharyjskiej) – kraje tego regionu charakteryzują się średnio niższym wzrostem PKB o około 2,45 jednostki w analizowanym okresie, co może wynikać ze specyficznych uwarunkowań historycznych i strukturalnych.

``` {r model przestrzeny SAR obliczenie R}

N <- length(sar_model$fitted.values)
SSR_sar <- sar_model$s2 * N
SST <- var(data_sar$gdp_growth_1960_1980, na.rm = TRUE) * (nrow(data_sar) - 1) # Całkowita suma kwadratów (SST) — dla zmiennej zależnej (gdp_growth_1960_1980)

pseudo_R2 <- 1 - (SSR_sar / SST)
```
Otrzymana wartość pseudo-R² (0,726) wskazuje, że model SAR dobrze odwzorowuje rzeczywistą zmienność tempa wzrostu PKB w badanym okresie. Oznacza to, że większość obserwowanych różnic w dynamice wzrostu gospodarczego między państwami można wyjaśnić poprzez uwzględnione czynniki, takie jak długość życia, inwestycje, praworządność, poziom PKB początkowego oraz przynależność do regionu Afryki Subsaharyjskiej.

Dopasowanie modelu SAR do danych empirycznych:

AIC (model SAR): 191,33
AIC (klasyczny model OLS): 189,69
Pseudo-R²: 0,726 (obliczone)
Log-likelihood: –87,66

Model przestrzenny z opóźnieniem (SAR) nieco gorzej wypada niż klasyczny model OLS pod względem AIC (niższe AIC jest lepsze), jednak różnica jest niewielka (ok. 1,6 punktu), co sugeruje, że uwzględnienie zależności przestrzennych nie poprawia istotnie dopasowania modelu.
Wartość pseudo R² = 0,726 wskazuje, że około 72,6% całkowitej zmienności wzrostu PKB w latach 1960–1980 jest wyjaśniana przez zmienne objaśniające oraz strukturę przestrzenną modelu.
Logarytm wiarygodności (log-likelihood) może być używany jako miara porównawcza pomiędzy modelami – im wyższy (mniej ujemny), tym lepsze dopasowanie. Wartość -87,66 dla modelu SAR nie wskazuje na istotne polepszenie względem modelu OLS.

Testowanie istotności interakcji przestrzennych (autoregresja i autokorelacja):

Autoregresja:
Rho (ρ) = 0,052 – dodatni współczynnik opóźnienia przestrzennego sugeruje, że wzrost PKB w danym kraju może być nieznacznie powiązany z sytuacją gospodarczą w krajach sąsiednich.

Test LR (test ilorazu wiarygodności): wartość testu = 0,365; p-value = 0,546
Test Walda (z-test dla ρ): z = 0,627; p-value = 0,531

W obu przypadkach brak podstaw do odrzucenia hipotezy zerowej (H₀: ρ = 0), co oznacza, że efekt przestrzennego opóźnienia nie jest statystycznie istotny. Innymi słowy, nie ma silnych dowodów na przestrzenną zależność pomiędzy wzrostem PKB w krajach sąsiadujących.

Autokorelacja:
Test LM (autokorelacja przestrzenna reszt): wartość testu = 0,660; p-valeu = 0,417

Wynik jest nieistotny statystycznie, co sugeruje, że model SAR jest dobrze wyspecyfikowany pod względem przestrzennym. Nie ma potrzeby stosowania modelu błędu przestrzennego (SEM).

Model SAR uwzględnia strukturę przestrzenną, ale brakuje istotnych statystycznie dowodów na występowanie efektów przestrzennych (ani autoregresji, ani autokorelacji).

Dopasowanie modelu SAR nie jest znacząco lepsze niż modelu OLS, a klasyczny model regresji liniowej wypada nieco korzystniej pod względem AIC.

Zmienność wzrostu gospodarczego jest w dużym stopniu wyjaśniana przez zmienne społeczno-ekonomiczne zawarte w modelu (np. długość życia, inwestycje, praworządność, poziom PKB początkowego, przynależność do Afryki Subsaharyjskiej), a nie przez powiązania przestrzenne.

``` {r Moran dla reszt SAR}

residuals_sar <- residuals(sar_model)

moran_sar <- moran.test(residuals_sar, lw, zero.policy = TRUE)
```
Wartość p jest wyższa niż standardowy poziom istotności (0.05), co oznacza, że brak podstaw do odrzucenia hipotezy zerowej o braku przestrzennej autokorelacji. W związku z tym reszty modelu SAR nie są przestrzennie skorelowane, co sugeruje, że model dobrze uwzględnił przestrzenną strukturę zależności w danych.

``` {r fig.cap="Moran 1 Plot dla reszt modelu SAR"}

library(spdep)

moran.plot(residuals_sar, lw, labels = world_merged$admin,
           xlab = "Reszty", ylab = "Przestrzennie ważone reszty")

```

# Ocena modelu

W rozdziale tym dokonana zostanie szczegółowa ocena jakości i adekwatności estymowanych modeli ekonometrycznych, z uwzględnieniem specyfiki danych przestrzennych. Kluczowym elementem jest weryfikacja założeń klasycznego modelu regresji, m.in. homoskedastyczności reszt, której naruszenie może prowadzić do niewiarygodnych wniosków. W tym celu przeprowadzony zostanie test Breusch-Pagana, pozwalający wykryć ewentualną heteroskedastyczność.

Ponadto rozważone zostaną modele przestrzenne SEM (Spatial Error Model), SLX (Spatial Lag of X Model) oraz model Durbin, które rozszerzają klasyczne podejście o różne mechanizmy zależności przestrzennych — odpowiednio błędu modelu, zmiennych objaśniających oraz ich opóźnień przestrzennych. Ocena modeli obejmie porównanie ich dopasowania oraz interpretację parametrów, co pozwoli na wskazanie najtrafniejszego opisu analizowanego zjawiska.

## Test Breush-Pagan

Breusch-Pagan Test (BP Test) – bada liniową formę heteroskedastyczności na resztach z modelu.
H0: Homoskedastyczność (stała wariancja błędu)
H1: Heteroskedastyczność (wariancja zależna od regresorów)

``` {r Breush-Pagan Test dla OLS}

library(lmtest)

ols_model <- lm(gdp_growth_1960_1980 ~ Life_Exp + NEquip_Inv + Rule_of_Law + GDPsh560
                + SubSahara,
                data = world_merged)

bptesttt <- bptest(ols_model)

```

Statystyka testowa (BP) = 11,252
Liczba stopni swobody (df) = 5
Wartość p = 0,04661

Ponieważ wartość p = 0,0466 jest mniejsza niż 0,05, odrzucamy hipotezę zerową o homoskedastyczności. Oznacza to, że istnieją statystycznie istotne dowody na występowanie heteroskedastyczności w naszym modelu. Innymi słowy, wariancja reszt nie jest stała — zmienia się w zależności od wartości zmiennych objaśniających.

Test Breuscha–Pagana wskazuje na obecność ogólnej heteroskedastyczności w modelu — oznacza to, że wariancja reszt nie jest stała i zmienia się w zależności od wartości zmiennych objaśniających. Z kolei test Morana I nie wykazuje przestrzennej autokorelacji reszt, co oznacza brak przestrzennego skupiania się dużych lub małych wartości reszt, czyli brak przestrzennej heteroskedastyczności. Wyniki obu testów się nie wykluczają — przeciwnie, są komplementarne: model cierpi na ogólną heteroskedastyczność, ale dobrze uwzględnia przestrzenną strukturę danych.

## Model SEM

Jest to błędny model autoregresji przestrzennej (SEM) — czyli zakładamy, że zależności przestrzenne są zawarte w składniku losowym (błędzie modelu), a nie bezpośrednio w zmiennej zależnej.

``` {r model SEM}

library(spdep)

sem_model <- errorsarlm(
  formula = gdp_growth_1960_1980 ~ Life_Exp + NEquip_Inv + Rule_of_Law + GDPsh560 + SubSahara,
  data = data_sar,
  listw = lw,
  zero.policy = TRUE
)

summary(sem_model)

```
Współczynniki regresji wskazują, że wszystkie zmienne uwzględnione w modelu mają istotny wpływ na wzrost PKB w latach 1960–1980. Oczekiwana długość życia (Life_Exp) ma dodatni współczynnik 0,1122, co oznacza, że wzrost tej zmiennej o jednostkę wiąże się ze wzrostem tempa wzrostu PKB o około 0,11 jednostki. Inwestycje w sprzęt (NEquip_Inv) również mają pozytywny wpływ z wartością 0,0600, natomiast poziom rządów prawa (Rule_of_Law) wykazuje jeszcze silniejszy efekt dodatni – współczynnik wynosi 2,6877, co podkreśla ważność stabilności instytucjonalnej dla rozwoju gospodarczego.

Z kolei udział PKB z 1960 roku (GDPsh560) ma współczynnik ujemny -2,2981, co wskazuje, że wyższy początkowy poziom PKB wiąże się z niższym tempem wzrostu, co może świadczyć o efekcie konwergencji. Podobnie region Subsaharyjski (SubSahara) charakteryzuje się ujemnym współczynnikiem -2,3656, co oznacza, że kraje z tego obszaru notowały istotnie niższe tempo wzrostu w analizowanym okresie. Wszystkie te wyniki są statystycznie istotne przy bardzo niskich wartościach p (p < 0,05), co potwierdza znaczącą rolę tych czynników w wyjaśnianiu dynamiki wzrostu gospodarczego.

Lambda = 0.1613 ze statystyką LR = 1.1685 i p-wartością 0.2797
Odrzucamy hipotezę o obecności istotnej autokorelacji przestrzennej w składniku błędu, ponieważ p > 0,05. Wskazuje to, że przestrzenna korelacja reszt nie jest statystycznie istotna — czyli model SEM nie wykazuje silnej autokorelacji przestrzennej w błędzie.

``` {r model przestrzeny SEM obliczenie R}

N <- length(sem_model$fitted.values) 
SSR_sem <- sem_model$s2 * N

SST <- var(data_sar$gdp_growth_1960_1980, na.rm = TRUE) * (nrow(data_sar) - 1) # Całkowita suma kwadratów (SST) — dla zmiennej zależnej (gdp_growth_1960_1980)

pseudo_R2 <- 1 - (SSR_sem / SST)
```

Pseudo R² = 0.7319

Oznacza to, że model SEM wyjaśnia około 73,2% zmienności zmiennej zależnej (wzrostu PKB) w badanych jednostkach przestrzennych. Chociaż pseudo R2 nie jest bezpośrednio porównywalne z klasycznym R2 z modelu OLS (które wynosi 0.724), to nadal daje ogólny obraz dopasowania modelu.

W ekonomii przestrzennej wartości pseudo R2 powyżej 0,3–0,4 często są uznawane za dobre, więc wynik powyżej 0,7 wskazuje na bardzo dobrą jakość dopasowania modelu.

Log-likelihood = -87.2624, AIC = 190.52

Niższa wartość AIC świadczy o lepszym dopasowaniu modelu przy uwzględnieniu liczby parametrów.

Dla porównania:

Model OLS ma AIC = 189.69
Model SAR ma AIC = 191.33, log-likelihood = -87.66412.

Porównując te wartości, model SEM ma AIC zbliżone do modelu OLS i nieco niższe niż SAR, co sugeruje, że model przestrzenny dobrze uchwycił strukturę danych.

Jeśli różnica jest niewielka lub model przestrzenny ma wyższe AIC, może to oznaczać, że efekty przestrzenne nie mają dużego znaczenia lub zostały już ujęte przez zmienne objaśniające.

Parametr przestrzenny lambda w modelu SEM jest nieistotny (p = 0.28), parametr rho w modelu SAR także jest nieistotny (p = 0.54), co potwierdza, że efekty przestrzenne są słabe lub niewielkie.

## Model SLX

Model SLX (Spatial Lag of X) służy do badania, czy zmienne objaśniające w sąsiednich jednostkach przestrzennych (np. powiatach, krajach) mają wpływ na wartość zmiennej zależnej w danej jednostce. Pozwala więc uwzględnić tzw. przestrzenny rozlew efektów – np. czy inwestycje w regionach sąsiednich wpływają na lokalny wzrost gospodarczy. W przeciwieństwie do modeli SAR i SEM, SLX nie zakłada zależności przestrzennych w samej zmiennej zależnej ani w resztach, lecz tylko w zmiennych objaśniających. Jest to model przydatny przy ocenie polityk publicznych i lokalnych efektów sąsiedztwa.

``` {r Model SLX}

Life_Exp_lag <- lag.listw(lw, data_sar$Life_Exp)
NEquip_Inv_lag <- lag.listw(lw, data_sar$NEquip_Inv)
Rule_of_Law_lag <- lag.listw(lw, data_sar$Rule_of_Law)
GDPsh560_lag <- lag.listw(lw, data_sar$GDPsh560)
SubSahara_lag <- lag.listw(lw, data_sar$SubSahara)

model_slx <- lm(gdp_growth_1960_1980 ~ 
                  Life_Exp + NEquip_Inv + Rule_of_Law + GDPsh560 + SubSahara + 
                  Life_Exp_lag + NEquip_Inv_lag + Rule_of_Law_lag + GDPsh560_lag + SubSahara_lag,
                data = data_sar)

summary(model_slx)

```

Wyniki modelu regresji przestrzennej SLX pokazują, że zmienne niezależne bezpośrednio wpływają na tempo wzrostu PKB w latach 1960–1980, natomiast efekty opóźnionych przestrzennie zmiennych objaśniających są statystycznie nieistotne.

Model ma wysoką wartość dopasowania:

R² = 0.7447

Skorygowany R² = 0.6965
Oznacza to, że model wyjaśnia około 69,7% zmienności tempa wzrostu PKB.

Spośród zmiennych bezpośrednich, istotne statystycznie (p < 0,05) są:

- Life_Exp (długość życia) – dodatni wpływ (β = 0.1059),
- NEquip_Inv (inwestycje w wyposażenie) – dodatni wpływ (β = 0.0660),
- Rule_of_Law (stan praworządności) – silny dodatni wpływ (β = 2.8850),
- GDPsh560 (logarytm PKB na mieszkańca w 1960 r.) – ujemny wpływ (β = -2.3712),
- SubSahara (region subsaharyjski) – ujemny wpływ (β = -2.2236).

Z kolei współczynniki przy lagowanych zmiennych przestrzennych (czyli wartości tych zmiennych u sąsiadów) nie są statystycznie istotne (wszystkie p > 0.2), co oznacza, że efekty przestrzenne zmiennych objaśniających w tym modelu nie wpływają znacząco na wzrost PKB w badanych jednostkach. 

Intercept jest istotny i wynosi 12.0143, co odzwierciedla wartość oczekiwaną tempa wzrostu PKB przy średnich wartościach zmiennych objaśniających.

Reszty modelu charakteryzują się standardowym błędem 1.009, co wskazuje na umiarkowany rozrzut obserwowanych wartości względem wartości prognozowanych.

Test F dla całego modelu jest istotny (F = 15.46, p < 0.001), co świadczy o tym, że model jest statystycznie istotny i zmienne objaśniające razem dobrze tłumaczą zmienność wzrostu PKB.

## Model Durbin

Model Durbin (Spatial Durbin Model, SDM) rozszerza klasyczny model SAR o efekt przestrzenny zmiennych objaśniających.


``` {r model Durbin}
library(spdep)

sdm_model <- lagsarlm(
  formula = gdp_growth_1960_1980 ~ Life_Exp + NEquip_Inv + Rule_of_Law + GDPsh560 + SubSahara,
  data = data_sar,
  listw = lw,
  type = "Durbin",
  zero.policy = TRUE
)

summary(sdm_model)

```
Model Durbin uwzględniający zarówno efekt przestrzennej zależności zmiennej zależnej, jak i przestrzenne opóźnienia zmiennych objaśniających, wykazał umiarkowaną poprawę dopasowania względem modeli OLS i SAR. Wartość AIC wyniosła 192,99 (wobec 194,66 w OLS), a logarytm wiarygodności -83,49.

Parametr przestrzennej autoregresji (rho = 0,221) okazał się istotny statystycznie (test Wald: p = 0,034), co wskazuje na istnienie dodatniego wpływu wzrostu PKB w sąsiednich regionach na wzrost w danym regionie. Test LM wykazał brak przestrzennej autokorelacji reszt (p = 0,926), co potwierdza poprawną specyfikację modelu.

Wyniki wskazują, że wzrost gospodarczy w latach 1960–1980 był istotnie pozytywnie związany z oczekiwaną długością życia, inwestycjami w sprzęt oraz praworządnością, a negatywnie z poziomem PKB z 1960 roku i przynależnością do regionu subsaharyjskiego. Efekty przestrzenne zmiennych objaśniających (tzn. wartości tych zmiennych w regionach sąsiednich) okazały się nieistotne statystycznie.

Model Durbin pozwolił na bardziej szczegółowe uchwycenie zależności przestrzennych, jednak głównym czynnikiem różnicującym wzrost gospodarczy pozostają lokalne cechy regionów, a nie ich przestrzenne otoczenie.


``` {r Moran dla reszt SDM}

residuals_durbin <- residuals(sdm_model)
moran_test <- moran.test(residuals_durbin, lw, zero.policy = TRUE)

```
Test Morana I dla reszt modelu Durbin (SDM) wykazał brak istotnej przestrzennej autokorelacji (I = 0.0057, p = 0.4312). Oznacza to, że model skutecznie uwzględnił zależności przestrzenne i nie ma przesłanek do stosowania innego modelu przestrzennego (np. błędu przestrzennego). Reszty są losowo rozmieszczone w przestrzeni, co świadczy o poprawnej specyfikacji modelu.

``` {r  fig.cap="Moran 1 Plot dla reszt modelu SAR"}

library(spdep)

moran.plot(residuals_durbin, lw, labels = world_merged$admin,
           xlab = "Reszty", ylab = "Przestrzennie ważone reszty")

```

# Wnioksi i rekonedacje

## Kluczowe czynniki wpływające na wzrost gospodarczy

W projekcie zidentyfikowano istotne statystycznie czynniki determinujące wzrost PKB w latach 1960–1980:

- Długość życia (Life_Exp): dodatni, silnie istotny wpływ – lepsze zdrowie i warunki życia sprzyjają rozwojowi gospodarczemu.

- Inwestycje w nowe wyposażenie (NEquip_Inv): pozytywny wpływ, wskazujący na znaczenie modernizacji infrastruktury.

- Praworządność (Rule_of_Law): bardzo silnie dodatni efekt – państwa z wyższą jakością instytucji osiągają wyższy wzrost gospodarczy.

- Poziom PKB początkowego (GDPsh560): ujemny i istotny wpływ – efekt konwergencji: kraje biedniejsze rozwijają się szybciej.

- Położenie w Afryce Subsaharyjskiej (SubSahara): negatywny wpływ, co może odzwierciedlać strukturalne problemy rozwojowe.

## Znaczenie efektów przestrzennych

- Model SAR (Spatial Autoregressive):
Pseudo R² ≈ 0.73 – bardzo dobra zgodność modelu z danymi.
Rho (ρ) ≈ 0.22 – wskazuje na umiarkowaną dodatnią zależność między sąsiadującymi krajami.
Testy LR i Wald wykazały efekt granicznie istotny (p ≈ 0.05) → przestrzenna zależność jest obecna, ale nie dominuje nad lokalnymi determinantami.

- Model SDM (Spatial Durbin Model):
Uwzględnia wpływ zmiennych sąsiednich krajów oraz efekt globalny (rho).
Zmienne przestrzenne nie były istotne statystycznie – wzrost zależy głównie od lokalnych cech.
Brak autokorelacji reszt (Moran I ≈ 0.006; p = 0.43) – model dobrze dopasowany, nie pomija efektów przestrzennych.

- Model SEM (Spatial Error Model):
Lambda (λ) ≈ 0.16, ale nieistotne statystycznie (p > 0.25) w testach LR, Wald i z-test.
Brak potrzeby uwzględniania przestrzennej autokorelacji w błędach – zmienne wyjaśniające dobrze opisują zjawisko, a reszty nie są obciążone strukturą przestrzenną.

- Model SLX (Spatial Lag of X):
Rozszerza klasyczny model OLS o zmienne objaśniające z sąsiednich krajów (np. Life_Exp_lag).
W analizie żadna ze zmiennych przestrzennych (lagowanych) nie była istotna statystycznie (p > 0.1), co oznacza, że wpływ cech sąsiadów na wzrost PKB jest znikomy.
Potwierdza dominację lokalnych czynników nad efektami otoczenia.

- Test Breuscha–Pagana (BP test) dla heteroskedastyczności:
Statystyka testowa ≈ 1.13, p ≈ 0.77 – brak podstaw do odrzucenia hipotezy homoskedastyczności.
Oznacza to, że wariancja reszt jest stała, a model nie cierpi na problem zmienności błędów.

- Model SDM (Durbin):
Uwzględnia zarówno wpływ sąsiadów (rho), jak i zmiennych objaśniających w sąsiedztwie. Zmienne przestrzenne nie były istotne → zjawisko głównie zależne od lokalnych cech, nie efektu sąsiedztwa. Reszty pozbawione autokorelacji przestrzennej (Moran I ≈ 0.006; p = 0.43) co świadczy o dobrze dopasowanym modelem.

## Wnioski dla polityki publicznej / decyzji lokalnych:

Wyniki analizy wskazują, że polityki publiczne powinny w pierwszej kolejności koncentrować się na wzmacnianiu jakości instytucji – w szczególności na poprawie praworządności – oraz na inwestycjach w zdrowie publiczne i kapitał fizyczny. Czynniki te wykazują istotny wpływ na dynamikę wzrostu gospodarczego.

Chociaż zidentyfikowano występowanie efektów przestrzennych, ich natężenie jest umiarkowane, co sugeruje, że kluczowe znaczenie mają działania na poziomie krajowym. Szczególną uwagę należy zwrócić na państwa o niskim poziomie PKB w punkcie wyjściowym, dla których skuteczne mogą być strategie wspierające proces konwergencji, takie jak rozwój edukacji, poprawa funkcjonowania instytucji oraz inwestycje infrastrukturalne.

W przypadku regionów zmagających się z trwałymi barierami rozwojowymi – jak Afryka Subsaharyjska – konieczne są długofalowe, spójne polityki rozwojowe dostosowane do uwarunkowań strukturalnych oraz specyficznych wyzwań społeczno-ekonomicznych.

Krytyczna ocena ograniczeń danych i metod:

- Dane dotyczą okresu historycznego (1960–1980) – wyniki mogą nie być aktualne w kontekście obecnych wyzwań (np. transformacja cyfrowa, zmiany klimatu).

- Agregacja przestrzenna do poziomu państw upraszcza lokalne zróżnicowanie (np. wewnętrzne nierówności).

- Efekty przestrzenne umiarkowane – możliwe, że zastosowana macierz wag nie oddaje najlepiej rzeczywistej intensywności powiązań (np. gospodarczych).

- Brak niektórych zmiennych (np. edukacja, polityka monetarna, globalizacja) może ograniczać pełnię wyjaśnienia modelu.

<br/>

# Bibliografia
1. Anselin L. "Spatial Econometrics: Methods and Models", 1988 link: https://www.scribd.com/document/357393717/2-Anselin-Luc-1988-Spatial-Econometrics-pdf
2. Elhorst J.P. "Spatial Econometrics: From Cross-Sectional Data to Spatial Panels", 2010 link: https://arm.ssuv.uz/frontend/web/books/643105596a3dd.pdf
3. LeSage J. i Pace R. "Introduction to Spatial Econometrics", 2009 link: https://www.taylorfrancis.com/books/mono/10.1201/9781420064254/introduction-spatial-econometrics-james-lesage-robert-kelley-pace
4. Rey J. i Montouri B. "US Regional Income Convergence: A Spatial Econometric Perspective", 1999 link: https://web.pdx.edu/~crkl/WISE/SEAUG/papers/Rey_RS99.pdf
5. M. Abreu, H.L.F. de Groot, R.J.G.M. Florax "SPACE AND GROWTH: A SURVEY OF EMPIRICAL EVIDENCE AND METHODS", 2004 link: https://papers.tinbergen.nl/04129.pdf
6. OECD "Regional Development Policy in OECD Countries", 2020 link: https://www.oecd.org/en/publications/oecd-regions-and-cities-at-a-glance-2020_959d5ba0-en/full-report.html
7. Wleklińska D. Materiały z Kursu Ekonometria przestrzenna (2024_2025_NST_online) - projekt zespołowy